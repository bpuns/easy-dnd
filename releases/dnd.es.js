var t;function e(t,e,s,r){if('a'===s&&!r)throw new TypeError('Private accessor was defined without a getter');if('function'==typeof e?t!==e||!r:!e.has(t))throw new TypeError('Cannot read private member from an object whose class did not declare it');return'm'===s?r:'a'===s?r.call(t):r?r.value:e.get(t)}function s(t,e,s,r,i){if('m'===r)throw new TypeError('Private method is not writable');if('a'===r&&!i)throw new TypeError('Private accessor was defined without a setter');if('function'==typeof e?t!==e||!i:!e.has(t))throw new TypeError('Cannot write private member to an object whose class did not declare it');return'a'===r?i.call(t,s):i?i.value=s:e.set(t,s),s}!function(t){t.SCOPE='scope',t.SWARAJ='swaraj'}(t||(t={})),'function'==typeof SuppressedError&&SuppressedError;const r=Symbol('bind-drag'),i=Symbol('easy-dnd');function n(t){return t instanceof HTMLElement}function a(t){const e=()=>t.dropDom.getBoundingClientRect(),s=()=>t.context,r={event:null,getContext:s,getDropInstance:()=>s().dropInstance,getDragType:()=>s().dragType,getDragData:()=>s().dragData};return{...r,getDragDom:()=>s().dragDom,getDomRect:e,isOverTop:(t,r)=>{const{y:i,height:n}=t||e();return s().dragCoord.y<i+n/(r?3:2)},isOverBottom:(t,r)=>{const{y:i,height:n}=t||e();return s().dragCoord.y>i+n/(r?1.5:2)},isOverLeft:(t,r)=>{const{x:i,width:n}=t||e();return s().dragCoord.x<i+n/(r?3:2)},isOverRight:(t,r)=>{const{x:i,width:n}=t||e();return s().dragCoord.x>i+n/(r?1.5:2)},isOverRowCenter(t){return t=t||e(),!this.isOverTop(t,!0)&&!this.isOverBottom(t,!0)},isOverColumnCenter(t){return t=t||e(),!this.isOverLeft(t,!0)&&!this.isOverRight(t,!0)},getRubbish:()=>s().getRubbish(),_s:r}}function o({dndMode:e=t.SWARAJ,delay:s=0}={}){(s<0||isNaN(s))&&(s=0);const r={};return{dndMode:e,delay:s,dropInstance:null,dragCoord:{x:0,y:0},dragType:null,dragDom:null,dragData:null,enterDom:null,dragItemDragStarts:new Set,dragItemDragEnds:new Set,dropItemDragStarts:new Set,dropItemDragEnds:new Set,getRubbish:()=>r}}function h(t){const e=()=>t.context;return{event:null,getContext:e,getRubbish:()=>e().getRubbish()}}var d,l,c,g,f,m,p,v,u,D,w,E,x,b,y,M,W,k,S,L,I,T,C,P,R,O,A,N;class j{constructor(t){this.monitor=h(this),d.set(this,!0),l.set(this,!1),c.set(this,!0),g.set(this,!1),f.set(this,void 0),this.registerDom=t=>(this.dragDom=t,n(t)&&(t[r]=!0),this),m.set(this,(t=>{const{dragDom:e}=this;n(e)?t?(e.setAttribute('draggable','true'),e.style.cursor='move'):(e.removeAttribute('draggable'),e.style.removeProperty('cursor')):s(this,c,t,'f')})),p.set(this,((t,s)=>{var r;const i=e(this,f,'f')[s];i&&(null===(r=this.dragDom)||void 0===r||r.classList[t](i))})),this.subscribe=()=>{if(e(this,g,'f'))return;const{dragDom:t,context:r}=this;if(!n(t))throw new Error('class Drag调用subscribe方法前必须调用registerDom方法');return e(this,m,'f').call(this,s(this,c,s(this,g,!0,'f'),'f')),r.dragItemDragStarts.add(e(this,M,'f')),r.dragItemDragEnds.add(e(this,W,'f')),e(this,b,'f').call(this),e(this,f,'f').hover&&t.addEventListener('mouseleave',e(this,u,'f')),t.addEventListener('dragstart',e(this,D,'f')),t.addEventListener('drag',e(this,w,'f')),t.addEventListener('dragend',e(this,E,'f')),this},this.unSubscribe=()=>{if(!e(this,g,'f'))return;const{dragDom:t,context:i}=this;t&&(e(this,m,'f').call(this,t[r]=s(this,c,s(this,g,!1,'f'),'f')),!e(this,d,'f')&&e(this,E,'f').call(this,this.monitor.event),e(this,y,'f').call(this),e(this,f,'f').hover&&t.removeEventListener('mouseleave',e(this,u,'f')),t.removeEventListener('dragstart',e(this,D,'f')),t.removeEventListener('drag',e(this,w,'f')),t.removeEventListener('dragend',e(this,E,'f')),this.dragDom=null),i.dragItemDragEnds.delete(e(this,W,'f')),i.dragItemDragStarts.delete(e(this,M,'f'))},v.set(this,(()=>{!this.context.dragDom&&e(this,c,'f')&&(s(this,l,!0,'f'),e(this,p,'f').call(this,'add','hover'))})),u.set(this,(()=>{e(this,l,'f')&&e(this,c,'f')&&(s(this,l,!1,'f'),e(this,p,'f').call(this,'remove','hover'))})),D.set(this,(t=>{var r;const{monitor:i,context:n,params:a,config:o}=this;t.stopPropagation(),i.event=t,n.dragType=o.type,n.dragDom=this.dragDom,n.dropInstance=null,n.dragData=null===(r=o.data)||void 0===r?void 0:r.call(o),s(this,d,!1,'f');const h=Array.from(this.dragDom.children);let l,c;for(l of h)l.style.pointerEvents='none';for(c of(a.dragStart&&a.dragStart(i),this.context.dragItemDragStarts))c();for(c of this.context.dropItemDragStarts)c();c=null,e(this,p,'f').call(this,'add','dragging')})),w.set(this,(t=>{const{dragCoord:e}=this.context;e.x=t.clientX,e.y=t.clientY,this.params.drag&&(this.monitor.event=t,this.params.drag(this.monitor))})),E.set(this,(t=>{const{monitor:r,params:i}=this;s(this,d,!0,'f'),r.event=t;const n=Array.from(this.dragDom.children);let a,o;for(a of n)a.style.pointerEvents='auto';for(o of(i.dragEnd&&i.dragEnd(r),this.context.dragItemDragEnds))o();for(o of this.context.dropItemDragEnds)o();e(this,x,'f').call(this),e(this,p,'f').call(this,'remove','dragging')})),x.set(this,(()=>{this.context.dragDom=null,this.context.dragData=null,this.context.enterDom=null,this.monitor.event=null})),b.set(this,(()=>{e(this,f,'f').hover&&this.dragDom&&this.dragDom.addEventListener('mouseenter',e(this,v,'f'))})),y.set(this,(()=>{e(this,f,'f').hover&&this.dragDom&&this.dragDom.removeEventListener('mouseenter',e(this,v,'f'))})),M.set(this,(()=>{e(this,u,'f').call(this),e(this,y,'f').call(this)})),W.set(this,(()=>{setTimeout((()=>e(this,b,'f').call(this)))})),this.params=t,this.config=t.config;const{className:i,context:a,defaultDraggable:o}=t.config;this.context=a,s(this,f,i||{},'f'),s(this,c,null==o||o,'f')}get draggable(){return e(this,c,'f')}set draggable(t){t!==e(this,c,'f')&&e(this,m,'f').call(this,s(this,c,t,'f'))}}d=new WeakMap,l=new WeakMap,c=new WeakMap,g=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,v=new WeakMap,u=new WeakMap,D=new WeakMap,w=new WeakMap,E=new WeakMap,x=new WeakMap,b=new WeakMap,y=new WeakMap,M=new WeakMap,W=new WeakMap;class B{constructor(i){this.monitor=a(this),this.isEnter=!1,this.prePosition={x:0,y:0},k.set(this,0),S.set(this,!1),L.set(this,void 0),I.set(this,!1),this.registerDom=t=>(this.dropDom=t,this),this.subscribe=()=>{if(e(this,S,'f'))return;const{dropDom:t}=this;if(!n(t))throw new Error('class Drop调用subscribe方法前必须调用registerDom方法');return s(this,S,!0,'f'),this.context.dropItemDragStarts.add(e(this,A,'f')),this.context.dropItemDragEnds.add(e(this,N,'f')),t.addEventListener('dragenter',e(this,C,'f')),t.addEventListener('dragover',e(this,P,'f')),t.addEventListener('dragleave',e(this,R,'f')),t.addEventListener('drop',e(this,O,'f')),this},this.unSubscribe=()=>{if(!e(this,S,'f'))return;const{dropDom:t}=this;t&&(s(this,S,!1,'f'),this.context.dropItemDragEnds.delete(e(this,N,'f')),this.context.dropItemDragStarts.delete(e(this,A,'f')),t.removeEventListener('dragenter',e(this,C,'f')),t.removeEventListener('dragover',e(this,P,'f')),t.removeEventListener('dragleave',e(this,R,'f')),t.removeEventListener('drop',e(this,O,'f')),this.dropDom=null)},T.set(this,((t,s)=>{var r;const i=e(this,L,'f')[s];i&&(null===(r=this.dropDom)||void 0===r||r.classList[t](i))})),this.canDrop=t=>{const{dragDom:e}=this.context;return!!e&&(this.monitor.event=t,(!this.dropDom[r]||e!==this.dropDom)&&(!!this.config.acceptType.has(this.monitor.getDragType())&&(this.config.canDrop?!!this.config.canDrop(this.monitor._s)&&(null==t||t.preventDefault(),!0):(null==t||t.preventDefault(),!0))))},this.stopPropagation=e=>{this.context.dndMode===t.SWARAJ&&e.stopPropagation()},C.set(this,(t=>{var r,i;if(this.stopPropagation(t),this.canDrop(t)&&0===(s(this,k,(i=e(this,k,'f'),r=i++,i),'f'),r)){this.context.enterDom=this.dropDom;const t=()=>{var t,s;this.enterTimer=null,this.context.enterDom===this.dropDom&&(this.isEnter=!0,null===(s=(t=this.params).dragEnter)||void 0===s||s.call(t,this.monitor),e(this,T,'f').call(this,'add','dragEnter'))},s=this.context.delay;s>0?this.enterTimer=setTimeout(t,s):t()}})),P.set(this,(t=>{var e,s;if(this.stopPropagation(t),this.canDrop(t)&&this.isEnter){const r=this.prePosition;r.x===t.clientX&&r.y===t.clientY||(r.x=t.clientX,r.y=t.clientY,null===(s=(e=this.params).dragOver)||void 0===s||s.call(e,this.monitor))}})),R.set(this,(t=>{var r,i,n;this.stopPropagation(t),this.canDrop(t)&&(s(this,k,(n=e(this,k,'f'),--n),'f')||(this.enterTimer?clearTimeout(this.enterTimer):this.isEnter&&(this.isEnter=!1,e(this,T,'f').call(this,'remove','dragEnter'),null===(i=(r=this.params).dragLeave)||void 0===i||i.call(r,this.monitor))))})),O.set(this,(t=>{var s,r;this.stopPropagation(t),this.canDrop(t)&&(this.context.dropInstance=this,e(this,T,'f').call(this,'remove','dragEnter'),null===(r=(s=this.params).drop)||void 0===r||r.call(s,this.monitor))})),A.set(this,(()=>{const{dragStart:t}=this.params;s(this,I,this.canDrop(),'f'),e(this,I,'f')&&(null==t||t(this.monitor),e(this,T,'f').call(this,'add','canDrop'))})),N.set(this,(()=>{const{dragEnd:t}=this.params;t&&e(this,I,'f')&&(null==t||t(this.monitor)),e(this,T,'f').call(this,'remove','canDrop'),s(this,k,0,'f'),this.isEnter=!1,this.monitor.event=null})),this.params=i,this.config=i.config,s(this,L,this.config.className||{},'f'),this.context=this.config.context}}k=new WeakMap,S=new WeakMap,L=new WeakMap,I=new WeakMap,T=new WeakMap,C=new WeakMap,P=new WeakMap,R=new WeakMap,O=new WeakMap,A=new WeakMap,N=new WeakMap;export{r as BIND_DRAG,i as DND_CTX,t as DND_MODE,j as DragCore,B as DropCore,h as createDragMonitor,a as createDropMonitor,o as createProvider,n as isElement};
